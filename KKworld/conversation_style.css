body { background-color: #f0f2f5; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; overscroll-behavior-y: contain; }
.chat-container { display: flex; flex-direction: column; height: 100vh; height: calc(var(--vh, 1vh) * 100); max-width: 500px; margin: 0 auto; background-color: #f0f2f5; box-shadow: 0 0 10px rgba(0,0,0,0.1); position: relative; overflow: hidden; }
.header { display: flex; align-items: center; padding: 10px 15px; background-color: #f7f7f7; border-bottom: 1px solid #e7e7e7; flex-shrink: 0; }
.back-button { font-size: 24px; font-weight: bold; color: #333; text-decoration: none; margin-right: 15px; }
.friend-info { flex-grow: 1; }
.friend-info .name { font-size: 18px; font-weight: 600; }
.friend-info .status { font-size: 12px; color: #888; display: block; }
.more-options { width: 24px; height: 24px; cursor: pointer; }
.message-area { flex-grow: 1; overflow-y: auto; padding: 10px; }
.message-wrapper { display: flex; margin-bottom: 15px; align-items: flex-start; }
.avatar { width: 40px; height: 40px; border-radius: 5px; flex-shrink: 0; }
.message { max-width: 70%; padding: 10px 12px; border-radius: 8px; position: relative; word-wrap: break-word; }
.sent { justify-content: flex-end; }
.sent .avatar { margin-left: 10px; }
.sent .message { background-color: #a0e75a; }
.received { justify-content: flex-start; }
.received .avatar { margin-right: 10px; }
.received .message { background-color: #ffffff; }
.message.text p { margin: 0; }
.message.sticker { background-color: transparent; padding: 0; }
.message.sticker img { max-width: 150px; max-height: 150px; }
.message.image img { max-width: 100%; border-radius: 6px; }
.message.transfer { background-color: #f8a92a; color: white; border-radius: 8px; width: 220px; }
.transfer-content { padding: 12px; }
.transfer-header { display: flex; align-items: center; }
.transfer-header span:first-child { font-size: 24px; margin-right: 8px; }
.transfer-amount { font-size: 28px; font-weight: bold; margin: 5px 0; }
.transfer-amount small { font-size: 18px; }
.transfer-remark { font-size: 14px; opacity: 0.9; }
.transfer-footer { font-size: 12px; padding: 6px 12px; background-color: white; color: #aaa; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; }
.message.red-packet { background-color: #f29c1f; color: white; border-radius: 8px; width: 220px; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; user-select: none; }
.message.red-packet:hover { transform: translateY(-2px); box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
.message.red-packet.opened { background-color: #f7d39d; cursor: default; }
.message.red-packet.opened .red-packet-header span { color: #c88c3a; }
.message.red-packet.opened .red-packet-remark { color: #c88c3a; }
.red-packet-content { padding: 12px; }
.red-packet-header { display: flex; align-items: center; margin-bottom: 10px; }
.red-packet-header span:first-child { font-size: 28px; margin-right: 10px; }
.red-packet-remark { font-size: 15px; font-weight: bold; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.red-packet-footer { font-size: 12px; padding: 6px 12px; background-color: white; color: #aaa; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px; }
.message.red-packet.opened .red-packet-footer { color: #bfa57b; }
.timestamp-separator { text-align: center; color: #aaa; font-size: 12px; margin: 15px 0; }
.reply-preview { display: none; padding: 8px 12px; background-color: #f0f0f0; font-size: 13px; color: #666; border-bottom: 1px solid #e0e0e0; align-items: center; justify-content: space-between; }
#reply-preview-content { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; padding-right: 10px; }
#close-reply-preview { background: none; border: none; cursor: pointer; font-size: 20px; color: #999; padding: 0 5px; line-height: 1; }
.quoted-message { background-color: rgba(0, 0, 0, 0.05); padding: 6px 10px; border-radius: 6px; margin-bottom: 5px; border-left: 3px solid #dcdcdc; font-size: 14px; }
.sent .quoted-message { border-left-color: #a0e75a; }
.received .quoted-message { border-left-color: #dcdcdc; }
.quoted-author { font-weight: bold; font-size: 13px; color: #555; display: block; margin-bottom: 2px; }
.quoted-text { margin: 0; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.input-area { display: flex; align-items: flex-end; padding: 8px 10px; background-color: #f7f7f7; flex-shrink: 0; }
#message-input { flex-grow: 1; border: none; padding: 10px; border-radius: 6px; font-size: 16px; resize: none; max-height: 100px; overflow-y: auto; background-color: white; }
#send-button { display: none; margin-left: 10px; background-color: #07c160; color: white; border: none; border-radius: 6px; padding: 10px 15px; font-size: 16px; cursor: pointer; }
#send-button.active { display: block; }
#transmit-button { margin-left: 10px; background-color: #1a73e8; border: none; border-radius: 6px; padding: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; }
#transmit-button img { width: 20px; height: 20px; }
.action-bar { display: flex; justify-content: space-around; padding: 5px 10px; background-color: #f7f7f7; border-top: 1px solid #e7e7e7; flex-shrink: 0; }
.action-bar img { width: 28px; height: 28px; cursor: pointer; }
.modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); display: none; justify-content: center; align-items: center; z-index: 3000; }
.modal-content { background-color: white; padding: 20px; border-radius: 12px; width: 90%; max-width: 400px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); display: flex; flex-direction: column; }
.modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
.modal-header h2 { margin: 0; font-size: 18px; }
.close-button { background: none; border: none; font-size: 24px; cursor: pointer; color: #999; }
.modal-body { overflow-y: auto; }
.modal-footer { margin-top: 20px; text-align: right; }
.save-button { background-color: #07c160; color: white; border: none; border-radius: 8px; padding: 10px 20px; cursor: pointer; }
.sticker-panel { position: absolute; bottom: 0; left: 0; width: 100%; height: 40%; background-color: #f7f7f7; display: none; flex-direction: column; z-index: 1000; }
.sticker-panel-header { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #e7e7e7; }
.sticker-grid { flex-grow: 1; display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; padding: 10px; overflow-y: auto; }
.sticker-item img { width: 100%; height: 100%; object-fit: contain; cursor: pointer; }
.context-menu { position: fixed; background: white; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.2); padding: 5px 0; z-index: 4000; display: none; }
.context-menu-item { padding: 10px 20px; cursor: pointer; }
.context-menu-item:hover { background-color: #f0f0f0; }
.finance-menu { display: none; position: absolute; bottom: 55px; background-color: #333; color: white; border-radius: 8px; padding: 5px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 1001; }
.finance-menu-item { padding: 10px 20px; cursor: pointer; white-space: nowrap; }
.finance-menu-item:hover { background-color: #555; }
.transfer-form-group { margin-bottom: 15px; }
.transfer-form-group label { display: block; margin-bottom: 5px; font-size: 14px; color: #555; }
.transfer-form-group input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
.modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
.modal-actions button { padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer; }
#cancel-transfer-btn, #cancel-rp-btn { background-color: #eee; }
#confirm-transfer-btn, #confirm-rp-btn { background-color: #07c160; color: white; }
#confirm-transfer-btn:disabled, #confirm-rp-btn:disabled { background-color: #9ee8bb; cursor: not-allowed; }
.error-message { color: #e64340; font-size: 12px; margin-top: 5px; }
.member-select-list { max-height: 20vh; overflow-y: auto; border: 1px solid #eee; border-radius: 8px; }
.member-select-item { display: flex; align-items: center; padding: 10px; cursor: pointer; }
.member-select-item:hover, .member-select-item.selected { background-color: #f0f8ff; }
.member-select-item img { width: 30px; height: 30px; border-radius: 50%; margin-right: 10px; }
#red-packet-details-modal { align-items: center; padding: 0 15px; }
.rp-details-content { background-color: #f7f7f7; width: 100%; max-width: 380px; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.2); display: flex; flex-direction: column; }
.rp-details-header { background-color: #e64340; color: white; padding: 15px; text-align: center; position: relative; }
.rp-details-header h2 { margin: 0; font-size: 18px; font-weight: 500; }
.rp-details-close-btn { position: absolute; top: 50%; right: 15px; transform: translateY(-50%); font-size: 24px; background: none; border: none; color: white; cursor: pointer; line-height: 1; }
.rp-details-sender { text-align: center; padding: 25px 15px 10px; }
.rp-details-sender-name { font-size: 16px; color: #555; }
.rp-details-sender-name strong { color: #000; font-weight: 600; }
.rp-details-sender-remark { font-size: 14px; color: #999; margin-top: 5px; }
.rp-details-amount { text-align: center; font-size: 40px; font-weight: bold; color: #d5a65a; padding: 5px 0 20px; }
.rp-details-amount small { font-size: 24px; }
.rp-details-summary { background-color: #fff; padding: 12px 15px; font-size: 13px; color: #999; border-top: 1px solid #f0f0f0; border-bottom: 1px solid #f0f0f0; }
.rp-grabber-list { flex-grow: 1; overflow-y: auto; background-color: #fff; padding: 0 15px; max-height: 30vh; }
.grabber-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f0f0f0; }
.grabber-item:last-child { border-bottom: none; }
.grabber-info { display: flex; flex-direction: column; }
.grabber-name { font-size: 16px; font-weight: 500; color: #333; display: flex; align-items: center; }
.my-tag { background-color: #f0ad4e; color: white; font-size: 10px; padding: 2px 5px; border-radius: 4px; margin-left: 8px; font-weight: normal; }
.grabber-time { font-size: 12px; color: #aaa; margin-top: 4px; }
.grabber-amount { text-align: right; }
.grabber-amount-value { font-size: 16px; font-weight: 500; color: #333; }
.best-luck-badge { display: block; font-size: 12px; color: #d5a65a; margin-top: 4px; }
.rp-details-footer { background-color: #f7f7f7; text-align: center; font-size: 12px; color: #bbb; padding: 15px; border-top: 8px solid #f0f0f0; }
.message .sender-nickname { font-size: 12px; color: #888; margin-bottom: 4px; padding: 0 2px; }
.message .sender-nickname .title-tag { font-size: 10px; margin-right: 5px; padding: 1px 4px; border-radius: 4px; color: white; vertical-align: middle; }
.owner-tag { background-color: #f0ad4e; }
.admin-tag { background-color: #1aad19; }
.custom-title-tag { background-color: #8e44ad; }

/* === 最终修正：群聊设置面板 (基于您的CSS进行微创手术) === */
.group-settings-panel { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: #f7f7f7; z-index: 2000; transform: translateX(100%); transition: transform 0.3s ease-in-out; display: flex; flex-direction: column; }
.group-settings-panel.show { transform: translateX(0); }
.settings-header { background-color: white; padding: 10px 15px; display: flex; align-items: center; border-bottom: 1px solid #eee; flex-shrink: 0; }
.settings-back-btn { font-size: 24px; background: none; border: none; cursor: pointer; padding-right: 15px; }
.settings-title { font-size: 18px; font-weight: 600; flex-grow: 1; text-align: center; margin-right: 40px; }
.settings-content { flex-grow: 1; overflow-y: auto; padding-bottom: 20px; }
.settings-section { background-color: white; margin-top: 10px; padding: 0 15px; }
.settings-section-header { font-size: 14px; color: #888; padding: 15px 0 5px; }
.settings-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f0f0f0; cursor: pointer; }
.settings-item:last-child { border-bottom: none; }
.settings-item-label { font-size: 16px; }
.settings-item .value-wrapper { display: flex; align-items: center; }
.settings-item-value { font-size: 15px; color: #888; max-width: 150px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.settings-item-arrow { color: #ccc; font-weight: bold; margin-left: 5px; }
.exit-group-btn { width: calc(100% - 30px); margin: 20px 15px 0; padding: 12px; background-color: #e64340; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; }
.report-link { display: block; text-align: center; color: #576b95; font-size: 12px; margin-top: 20px; cursor: pointer; }
.settings-member-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 15px; padding: 10px 0; }
.member-avatar-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; }
.member-avatar-item img { width: 50px; height: 50px; border-radius: 50%; object-fit: cover; margin-bottom: 5px; }
.member-avatar-item span { font-size: 12px; color: #333; width: 100%; text-align: center; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.member-select-modal .modal-content { background-color: #f7f7f7; height: auto; max-height: 70vh; }
#invite-member-list, #remove-member-list { display: flex; flex-direction: column; background-color: white; border-radius: 8px; margin: 10px; padding: 0 15px; }
.invite-member-item, .remove-member-item { padding: 12px 0; cursor: pointer; display: flex; align-items: center; border-bottom: 1px solid #f0f0f0; }
.invite-member-item:last-child, .remove-member-item:last-child { border-bottom: none; }
.invite-member-item input[type="checkbox"], .remove-member-item input[type="checkbox"] { margin-right: 15px; width: 20px; height: 20px; flex-shrink: 0; }
.invite-member-item span, .remove-member-item span { font-size: 16px; }
#group-manage-modal .modal-content { height: auto; max-height: 80vh; }
#manage-member-list .member-item { display: flex; align-items: flex-start; padding: 10px; border-bottom: 1px solid #f0f0f0; }
#manage-member-list img { width: 40px; height: 40px; border-radius: 8px; margin-right: 10px; flex-shrink: 0; }
.member-details { flex-grow: 1; min-width: 0; display: flex; flex-direction: column; align-items: flex-start; }
.member-details .name-wrapper { display: flex; align-items: center; }
.member-details .name { font-size: 16px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.member-actions { flex-shrink: 0; margin-left: 10px; display: flex; flex-direction: column; align-items: flex-end; gap: 8px; }
.member-actions button { border: 1px solid #ddd; background-color: #f7f7f7; padding: 5px 10px; white-space: nowrap; border-radius: 4px; cursor: pointer; }

/* === 最终修正：群聊昵称/头衔布局 (v3) === */

/* 核心：为所有消息（sent和received）建立一个内容包装器 */
.message-content-wrapper {
    display: flex;
    flex-direction: column;
}
/* 让我方（sent）的内容（昵称+气泡）靠右对齐 */
.sent .message-content-wrapper {
    align-items: flex-end;
}
/* 让他方（received）的内容（昵称+气泡）靠左对齐 */
.received .message-content-wrapper {
    align-items: flex-start;
}

/* 核心：现在，对所有发送者（包括自己）的昵称栏应用样式 */
.sender-nickname {
    font-size: 12px;
    color: #888; /* 这是昵称本身的颜色 */
    margin-bottom: 4px;
    padding: 0 2px;
    display: block; /* 确保它能正常显示 */
}

/* 核心：修正所有头衔标签的样式，确保是“背景色+白色文字” */
.title-tag {
    font-size: 10px;
    margin-right: 5px;
    padding: 1px 5px;
    border-radius: 4px;
    color: white !important; /* 强制使用白色文字！*/
    vertical-align: middle;
}
/* 为不同身份设置不同的背景色 */
.owner-tag { background-color: #f0ad4e; }
.admin-tag { background-color: #1aad19; }
.custom-title-tag { background-color: #8e44ad; }

/* === @提及功能样式 === */
.at-mention-panel {
    display: none;
    position: absolute;
    bottom: 55px; /* 根据你的输入区域高度调整 */
    left: 10px;
    right: 10px;
    background-color: white;
    border: 1px solid #e7e7e7;
    border-radius: 8px;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
    max-height: 200px;
    overflow-y: auto;
    z-index: 1002;
}
.at-mention-item {
    display: flex;
    align-items: center;
    padding: 8px 12px;
    cursor: pointer;
    border-bottom: 1px solid #f0f0f0;
}
.at-mention-item:last-child {
    border-bottom: none;
}
.at-mention-item:hover {
    background-color: #f7f7f7;
}
.at-mention-avatar {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    margin-right: 10px;
}
.at-mention-name {
    font-size: 15px;
    color: #333;
}